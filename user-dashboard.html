<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>User - Helpdesk IT</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 min-h-screen p-4">
  <header class="flex items-center justify-between mb-4">
    <h2 class="text-lg font-semibold">Buat Tiket</h2>
    <div class="flex gap-2">
      <button id="to-list" class="text-sm px-3 py-1 rounded bg-white shadow">Daftar Tiket</button>
      <button id="logout" class="text-sm px-3 py-1 rounded bg-white shadow">Logout</button>
    </div>
  </header>

  <section class="mb-4">
    <form id="ticket-form" class="space-y-3 bg-white p-4 rounded-lg shadow">
      <div>
        <label class="text-sm">Judul</label>
        <input id="title" required class="w-full mt-1 p-2 border rounded" placeholder="Contoh: Printer kantor tidak merespon" />
      </div>
      <div>
        <label class="text-sm">Kategori</label>
        <select id="category" class="w-full mt-1 p-2 border rounded">
          <option>Hardware</option>
          <option>Software</option>
          <option>Network</option>
          <option>Access</option>
          <option>Lainnya</option>
        </select>
      </div>
      <div>
        <label class="text-sm">Deskripsi</label>
        <textarea id="description" rows="4" class="w-full mt-1 p-2 border rounded" placeholder="Jelaskan masalah secara singkat dan langkah yang sudah dicoba."></textarea>
      </div>
      <div class="flex justify-end">
        <button type="submit" class="px-4 py-2 rounded bg-indigo-600 text-white">Kirim Tiket</button>
      </div>
    </form>
  </section>

  <section>
    <h3 class="text-sm font-medium mb-2">Tiket Saya</h3>
    <div id="my-tickets" class="space-y-3"></div>
  </section>

  <script src="../scripts/app.js"></script>
  <script>
    (function(){
      if(localStorage.getItem('helpdesk_role')!=='user'){
        window.location.href = 'index.html';
      }
      const form = document.getElementById('ticket-form');
      form.addEventListener('submit', (e)=>{
        e.preventDefault();
        const title = document.getElementById('title').value.trim();
        const category = document.getElementById('category').value;
        const description = document.getElementById('description').value.trim();
        window.Helpdesk.createTicket({title,category,description});
        form.reset();
        renderTickets();
      });
      document.getElementById('logout').addEventListener('click', ()=>{ localStorage.removeItem('helpdesk_role'); window.location.href='index.html'; });
      document.getElementById('to-list').addEventListener('click', renderTickets);
      function renderTickets(){
        const container = document.getElementById('my-tickets');
        container.innerHTML='';
        const tickets = window.Helpdesk.getTickets({owner: window.Helpdesk.getCurrentUserId()});
        if(!tickets.length) container.innerHTML = '<div class="p-4 bg-white rounded shadow text-sm text-slate-500">Belum ada tiket.</div>';
        tickets.forEach(t=>{
          const el = document.createElement('div');
          el.className='p-3 bg-white rounded shadow';
          el.innerHTML = `<div class="flex justify-between"><div><div class="font-medium">${t.title}</div><div class="text-xs text-slate-400">${t.category} â€¢ ${new Date(t.createdAt).toLocaleString()}</div></div><div class="text-xs">${t.status}</div></div>`;
          el.addEventListener('click', ()=>{ localStorage.setItem('open_ticket', t.id); window.location.href='ticket-detail.html'; });
          container.appendChild(el);
        });
      }
      renderTickets();
    })();
  </script>
</body>
</html>